---
title: 2017年清华大学保研机试第1题：面试（线段树）
urlname: 2017-thupub-1-interview
toc: true
date: 2018-12-06 14:51:02
updated: 2018-12-12 00:00:42
tags: [alg:Binary Search]
---

请在[这里](/files/code+-5-5.pdf)下载讲义。

## 题意

给定长度为$n$的数组，问其中至少存在$m$个最大值和最小值之差小于等于$k$的数的数组前缀的最小长度是多少。

$1\leq m \leq n \leq 10^5$，$0 \leq k \leq 10^5$，数组中的数$h_i$满足$1 \leq h \leq 10^5$。

其中每个测试点的具体情况：

![测试点具体情况](testpoints.png)

## 分析

### 10分解法：暴力

测试点1-2满足$1\leq m \leq n \leq 100$，$k = 0$且$1 \leq h_i \leq 100$，因此可以直接判断每个数组前缀中某个数出现的次数是否大于等于$m$。算法复杂度为$O(nL)$（$L$是$h_i$的范围，此时为100）。

<script src="https://gist.github.com/zhanghuimeng/f0681c0bc71f6204255c21e91c8e5d58.js?file=interview_10pts.cpp"></script>

### 60分解法：暴力

<!--（真的没有必要写20分和40分了吧，随便一暴力就60分了……）-->

测试点1-12满足$1\leq m \leq n \leq 2000$，$0 \leq k \leq 5000$且$1 \leq h_i \leq 5000$，可以直接判断每个数组前缀中，每个长度为$k+1$的区间内是否有$m$个数。算法复杂度为$O(nkL)$。用类似于前缀和的方法可以优化为$O(nL)$。

<script src="https://gist.github.com/zhanghuimeng/f0681c0bc71f6204255c21e91c8e5d58.js?file=interview_60pts.cpp"></script>

### 70(80)分解法：经过优化的暴力

可以观察到一个现象：每次更新哈希值时，只有包含这个值的长度为$k+1$的区间的和会更新。因此上述$O(nL)$的算法可以优化为$O(nk)$，可以进一步通过测试点15-16（这两个测试点满足$0 \leq k \leq 100$）。

这个算法本来设计的是能过测试点1-12和15-16，结果测试后发现13-14也过了。这是因为这两个测试点的$k$出的比较小，只有5e4左右，如果出成1e5，应该是过不了的。

<script src="https://gist.github.com/zhanghuimeng/f0681c0bc71f6204255c21e91c8e5d58.js?file=interview_80pts.cpp"></script>

### 100分解法：二分答案

在之前所有的解法中，我们都判断了每一个前缀是否符合要求，直到找到符合要求的前缀，或者发现每一个前缀都不符合要求。事实上，由于这个问题的答案具有单调性（当某一个前缀符合要求的时候，之后的前缀必然都符合要求），我们可以采用**二分答案**的方法来求解这道题，只判断有限多（约$\log{n}$）个前缀的情况。这种做法的复杂度是$O((n+L)\log{n})$，可以通过全部测试点。

<script src="https://gist.github.com/zhanghuimeng/f0681c0bc71f6204255c21e91c8e5d58.js?file=interview_100pts.cpp"></script>
