---
title: 《操作系统》第23讲：“I/O子系统”总结
urlname: os-mooc-lecture-23-summary
toc: true
mathjax: true
tags: [操作系统, 课程总结]
---

## 课程内容概述

## 练习

来自[lec23 IO设备 在线练习](https://github.com/chyyuu/os_course_exercises/blob/2018spring/all/10-1-quiz.md)和[IO设备(lec 23) spoc 思考题](https://github.com/chyyuu/os_course_exercises/blob/2018spring/all/10-1-spoc-discussion.md)。

### 选择填空题

**字符设备包括（）**

* **键盘**
* **鼠标**
* **并口**
* **串口**

都是。因为它们的访问特征都是以字节为单位顺序访问。

---

**块设备包括（）**

* **硬盘**
* **软盘**
* **光盘**
* **U盘**

都是。因为它们的访问特征都是均匀的数据块访问。

---

**网络设备包括（）**

* **以太网卡**
* **wifi网卡**
* **蓝牙设备**
* 网盘设备

网络设备的访问特征是格式化报文交换。而网盘在模拟实现上应该算块设备。

---

**关于CPU与设备的通信方式包括（）**

* **轮询**
* **设备中断**
* **DMA**
* PIPE

PIPE是用于进程间通信的。虽然DMA听起来是直接把数据写入到内存，不过还是需要CPU参与设置的。

---

**关于IO数据传输的阐述正确的是（）**

* **程序控制I/O(PIO, Programmed I/O)通过CPU的in/out或者load/store传输所有数据**
* **DMA设备控制器可直接访问系统总线并直接与内存互相传输数据**
* DMA机制适合字符设备
* PIO机制适合块设备

DMA机制适合块设备，PIO机制适合简单，低速的字符设备等。最后两个选项反了。

---

**常用移臂调度算法包括（）**

* **先来先服务（FIFO）算法**
* **最短寻道时间优先（SSTF）算法**
* **电梯调度（SCAN）算法**
* **单向扫描（C-SCAN）算法**

都对。除此之外还有CLOOK和N-step-SCAN算法。

---

**在设备管理子系统中，引入缓冲区的目的主要有()**

* **缓和CPU与I/O设备间速度不匹配的矛盾**
* **减少对CPU的中断频率，放宽对CPU中断响应时间的限制**
* **解决基本数据单元大小（即数据粒度）不匹配的问题**
* **提高CPU和I/O设备之间的并行性**

都对。

### 简答题

**字符设备的特点是什么？**

以字节为单位顺序访问。

---

**块设备的特点是什么？**

以均匀的数据块为单位随机访问。

---

**网络设备的特点是什么？**

以格式化报文为单位的复杂交互访问。

---

**阻塞I/O、非阻塞I/O和异步I/O这三种I/O方式有什么区别？**

* 阻塞I/O：数据读写操作后，进程将进入等待状态，直到完成操作时返回；
* 非阻塞I/O：数据读写操作后，进程将立即返回；
* 异步I/O：数据读写操作后，进程将立即返回；内核在完成操作时通知进程；

区别：
* 进程发出操作命令后，进程是否等待；
* 操作结果反馈方式

---

**请描述I/O请求到完成的整个执行过程。**

CPU通过总线与设备相连；CPU通过主动的I/O端口和映射内存读写操作与设备进行信息交互；设备通过中断请求来响应CPU的操作；在CPU的控制下，DMA可直接在设备接口与内存间的数据传输。

1. 进程通过系统调用发送对设备的抽象操作命令
2. 内核把抽象的设备操作命令转换成具体的设备I/O端口和映射内存读写序列，并在设备驱动中实施读写操作
3. 当这个读写序列较长时，CPU会控制DMA进行内存与设备接口的直接数据传送
4. 设备在收到控制序列后，执行操作动作，并在完成时向CPU发出中断请求
5. CPU通过中断服务例程响应设备的中断请求，并进行后续处理，直到系统调用返回，从而完成整个I/O操作过程。

---

**IO数据传输有哪几种？**

* 程序控制I/O：
  * CPU通过显式的IO指令，如x86的in, out等传输数据
  * memory读写方式，即把device的寄存器，内存等映射到物理内存中
* 直接内存访问（DMA）：在CPU的控制下，DMA控制器直接在内存与设备接口间传输数据

---

**轮询方式的特点是什么？**

* 简单
* I/O操作频繁或不可预测时，开销大和延时长

---

**中断方式的特点是什么？**

* 处理不可预测事件效果好
* 开销相对较高

---

**DMA方式的特点是什么？**

* 直接在内存与设备接口间进行数据传输
* 适合高速和简单的数据传输
* CPU的开销小

---

**请简要阐述磁盘的工作过程。**

* 磁头移动到期望的磁道
* 盘片旋转定位到期望的柱面和扇区
* 开始读写

---

**请描述磁盘I/O操作时间组成。**

磁盘I/O操作一般分成五个步骤：
* 等待设备可用
* 等待通道（PIO或DMA通道）可用
* 寻道
* 旋转延迟
* 数据传输

其中后四个步骤被称为“设备忙”状态，一般认为是传输时间，公式为：

$$T_a = T_s+ \frac{1}{2} r + \frac{b}{rN}$$

---

**请说明磁盘调度算法的评价指标。**

* 总的I/O时间开销（显然）
* 公平性
* 平均等待时间（似乎这对磁盘调度不是很重要）

---

**请描述FIFO、SSTF、SCAN、CSCAN、LOOK、C-LOOK、N-step-SCAN和FSCAN等磁盘调度算法的工作原理。**

磁盘调度算法就是优化磁盘数据块的访问顺序。

* 先进先出（FIFO）算法：按请求顺序访问
* 最短寻道时间优先（SSTF）算法：从当前位置找当前最近的访问数据块位置
* 扫描（SCAN）算法：保持磁头移动方向到最远处，并顺序访问需要访问的数据块
* 循环扫描（C-SCAN）算法：只在一个方向上移动时访问数据的SCAN算法
* LOOK算法：保持磁头移动方向到已有的最后一个请求，并顺序访问需要访问的数据块
* C-LOOK算法：只在一个方向上移动时访问数据的LOOK算法；
* N步扫描（N-step-SCAN）算法：
  1. 将磁盘请求队列分成长度为N的子队列
  2. 按FIFO算法依次处理所有子队列
  3. 按扫描算法处理每个队列
* 双队列扫描（FSCAN）算法：1）把磁盘I/O请求分成两个队列，交替使用扫描算法处理一个队列；2）新生成的磁盘I/O请求放入另一队列中

23.5 磁盘缓存
磁盘缓存的作用是什么？
磁盘扇区在内存中的缓存区，作用是通过缓存访问，减少磁盘访问；

请描述单缓存(Single Buffer Cache)的工作原理
只一个缓存区，用户进程和I/O设备只能交替访问缓存区；

请描述双缓存(Double Buffer Cache)的工作原理
设置两个缓存区，任何时刻用户进程和I/O设备可同时访问不同的缓存区；

请描述访问频率置换算法(Frequency-based Replacement)的基本原理
思路：短周期内采用LRU，长周期内采用LFU

做法：把栈分成三个区域：新区域、中间区域、旧区域

新区域中数据块的引用，不计数；

中间区域和旧区域中数据块的引用，引用计数加1；

淘汰只在旧区域中找引用计数最小的数据块

小组思考题
(spoc)请以键盘输入、到标准输出设备stdout的printf输出、串口输出、磁盘文件复制为例，描述ucore操作系统I/O从请求到完成的整个执行过程，并分析I/O过程的时间开销。
(spoc)完成磁盘访问与磁盘寻道算法的作业，然后实现CSCAN、LOOK、C-LOOK、FSCAN等磁盘调度算法中的一个。具体帮助和要求信息请看Chapter 37: Hard Disk Drives、disksim指导信息和disksim参考代码

### 实践题
